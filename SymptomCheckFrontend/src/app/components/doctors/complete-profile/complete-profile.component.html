<div class="complete-profile-container">
  <h2>Complétez votre profil</h2>

  <form [formGroup]="profileForm" (ngSubmit)="submitForm()">

    <!-- Infos basiques -->
    <div class="form-section">
      <h3>Informations professionnelles</h3>
      <div class="form-group">
        <label>Spécialité *</label>
        <input formControlName="speciality" class="form-control" />
        <div *ngIf="profileForm.get('speciality')?.invalid && profileForm.get('speciality')?.touched" 
             class="error-message">
          La spécialité est requise
        </div>
      </div>

      <div class="form-group">
        <label>Description *</label>
        <textarea formControlName="description" class="form-control"></textarea>
        <div *ngIf="profileForm.get('description')?.invalid && profileForm.get('description')?.touched" 
             class="error-message">
          La description est requise
        </div>
      </div>

      <div class="form-group">
        <label>Diplôme *</label>
        <input formControlName="diploma" class="form-control" />
        <div *ngIf="profileForm.get('diploma')?.invalid && profileForm.get('diploma')?.touched" 
             class="error-message">
          Le diplôme est requis
        </div>
      </div>

      <div class="form-group">
        <label>Photo de profil URL</label>
        <input formControlName="profilePhotoUrl" class="form-control" />
      </div>

      <div class="form-group">
        <label>Clinique ID</label>
        <input formControlName="clinicId" class="form-control" />
      </div>
    </div>

    <!-- Disponibilités -->
    <div formArrayName="availabilities" class="form-section">
      <h3>Disponibilités</h3>
      <button type="button" class="btn btn-secondary" (click)="addAvailability()">
        + Ajouter une plage horaire
      </button>

      <div *ngFor="let avail of availabilities.controls; let i=index" [formGroupName]="i" class="availability-group">
        <div class="availability-header">
          <h4>Plage horaire {{ i + 1 }}</h4>
          <button type="button" class="btn btn-danger btn-sm" (click)="removeAvailability(i)" 
                  [disabled]="availabilities.length === 1">
            Supprimer
          </button>
        </div>

        <div class="form-group">
          <label>Jours disponibles *</label>
          <div class="days-container">
            <div *ngFor="let d of daysOfWeek" class="day-checkbox">
              <label>
                <input 
                  type="checkbox"
                  [value]="d.value"
                  (change)="toggleDay(i, d.value, $event)"
                  [checked]="isDaySelected(i, d.value)"
                />
                {{ d.label }}
              </label>
            </div>
          </div>
          <div *ngIf="avail.get('days')?.invalid && avail.get('days')?.touched" class="error-message">
            Au moins un jour doit être sélectionné
          </div>
        </div>

        <div class="time-row">
          <div class="form-group">
            <label>Heure de début *</label>
            <input formControlName="startTime" type="time" class="form-control" />
            <div *ngIf="avail.get('startTime')?.invalid && avail.get('startTime')?.touched" class="error-message">
              L'heure de début est requise
            </div>
          </div>

          <div class="form-group">
            <label>Heure de fin *</label>
            <input formControlName="endTime" type="time" class="form-control" />
            <div *ngIf="avail.get('endTime')?.invalid && avail.get('endTime')?.touched" class="error-message">
              L'heure de fin est requise
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Services -->
    <div formArrayName="services" class="form-section">
      <h3>Services médicaux</h3>
      <button type="button" class="btn btn-secondary" (click)="addService()">
        + Ajouter un service
      </button>

      <div *ngFor="let srv of services.controls; let i=index" [formGroupName]="i" class="service-group">
        <div class="service-header">
          <h4>Service {{ i + 1 }}</h4>
          <button type="button" class="btn btn-danger btn-sm" (click)="removeService(i)">
            Supprimer
          </button>
        </div>

        <div class="form-group">
          <label>Nom du service *</label>
          <input formControlName="name" class="form-control" />
          <div *ngIf="srv.get('name')?.invalid && srv.get('name')?.touched" class="error-message">
            Le nom du service est requis
          </div>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea formControlName="description" class="form-control" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label>Catégorie</label>
          <input formControlName="category" class="form-control" />
        </div>

        <div class="form-group">
          <label>Image URL</label>
          <input formControlName="imageUrl" class="form-control" />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Prix (€) *</label>
            <input formControlName="price" type="number" class="form-control" min="0" step="0.01" />
            <div *ngIf="srv.get('price')?.invalid && srv.get('price')?.touched" class="error-message">
              Le prix est requis et doit être positif
            </div>
          </div>

          <div class="form-group">
            <label>Durée (minutes) *</label>
            <input formControlName="durationMinutes" type="number" class="form-control" min="1" />
            <div *ngIf="srv.get('durationMinutes')?.invalid && srv.get('durationMinutes')?.touched" class="error-message">
              La durée est requise
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="loading">
        {{ loading ? 'Enregistrement...' : 'Enregistrer le profil' }}
      </button>
      <button type="button" class="btn btn-outline" (click)="router.navigate(['/dashboard'])">
        Annuler
      </button>
    </div>

    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>
  </form>
</div>