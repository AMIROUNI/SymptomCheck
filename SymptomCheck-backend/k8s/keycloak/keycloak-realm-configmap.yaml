apiVersion: v1
kind: ConfigMap
metadata:
  name: keycloak-realm-config
  namespace: symptomcheck-backend
data:
  symptomcheck-realm.json: |
    {
      "realm": "symptomcheck-realm",
      "enabled": true,
      "roles": {
        "realm": [
          {
            "name": "PATIENT",
            "description": "Patient role"
          },
          {
            "name": "DOCTOR",
            "description": "Doctor role"
          },
          {
            "name": "ADMIN",
            "description": "Administrator role"
          }
        ]
      },
      "users": [
        {
          "username": "admin",
          "enabled": true,
          "emailVerified": true,
          "firstName": "Admin",
          "lastName": "User",
          "email": "admin@symptomcheck.local",
          "attributes": {
            "phoneNumber": ["+1234567890"],
            "isProfileComplete": ["true"],
            "localUserId": ["admin-001"]
          },
          "credentials": [
            {
              "type": "password",
              "value": "admin123",
              "temporary": false
            }
          ],
          "realmRoles": ["ADMIN"],
          "clientRoles": {
            "account": ["manage-account", "view-profile"]
          }
        },
        {
          "username": "doctor1",
          "enabled": true,
          "emailVerified": true,
          "firstName": "John",
          "lastName": "Doe",
          "email": "doctor@symptomcheck.local",
          "attributes": {
            "phoneNumber": ["+1987654321"],
            "isProfileComplete": ["true"],
            "clinicId": ["clinic-001"],
            "localUserId": ["doctor-001"]
          },
          "credentials": [
            {
              "type": "password",
              "value": "doctor123",
              "temporary": false
            }
          ],
          "realmRoles": ["DOCTOR"],
          "clientRoles": {
            "account": ["manage-account", "view-profile"]
          }
        },
        {
          "username": "patient1",
          "enabled": true,
          "emailVerified": true,
          "firstName": "Jane",
          "lastName": "Smith",
          "email": "patient@symptomcheck.local",
          "attributes": {
            "phoneNumber": ["+1555555555"],
            "isProfileComplete": ["true"],
            "localUserId": ["patient-001"]
          },
          "credentials": [
            {
              "type": "password",
              "value": "patient123",
              "temporary": false
            }
          ],
          "realmRoles": ["PATIENT"],
          "clientRoles": {
            "account": ["manage-account", "view-profile"]
          }
        }
      ],
      "clients": [
        {
          "clientId": "userservice-client",
          "name": "User Service Client",
          "description": "Client for user service authentication",
          "enabled": true,
          "publicClient": true,
          "directAccessGrantsEnabled": true,
          "standardFlowEnabled": true,
          "implicitFlowEnabled": false,
          "serviceAccountsEnabled": false,
          "redirectUris": ["*"],
          "webOrigins": ["*"],
          "protocol": "openid-connect",
          "attributes": {
            "pkce.code.challenge.method": "S256"
          },
          "protocolMappers": [
            {
              "name": "phoneNumber",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "phoneNumber",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "phoneNumber",
                "jsonType.label": "String"
              }
            },
            {
              "name": "profilePhotoUrl",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "profilePhotoUrl",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "profilePhotoUrl",
                "jsonType.label": "String"
              }
            },
            {
              "name": "isProfileComplete",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "isProfileComplete",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "isProfileComplete",
                "jsonType.label": "String"
              }
            },
            {
              "name": "clinicId",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "clinicId",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "clinicId",
                "jsonType.label": "String"
              }
            },
            {
              "name": "localUserId",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "localUserId",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "localUserId",
                "jsonType.label": "String"
              }
            }
          ]
        },
        {
          "clientId": "angular-client",
          "name": "Angular Frontend Client",
          "description": "Public client for the Angular application",
          "enabled": true,
          "protocol": "openid-connect",
          "publicClient": true,
          "standardFlowEnabled": true,
          "implicitFlowEnabled": false,
          "directAccessGrantsEnabled": true,
          "serviceAccountsEnabled": false,
          "redirectUris": [
            "http://localhost:4200/*"
          ],
          "webOrigins": [
            "http://localhost:4200"
          ],
          "attributes": {
            "pkce.code.challenge.method": "S256",
            "post.logout.redirect.uris": "http://localhost:4200/*"
          },
          "protocolMappers": [
            {
              "name": "realm roles",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-realm-role-mapper",
              "consentRequired": false,
              "config": {
                "multivalued": "true",
                "userinfo.token.claim": "true",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "roles",
                "jsonType.label": "String"
              }
            },
            {
              "name": "email",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-property-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "email",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "email",
                "jsonType.label": "String"
              }
            },
            {
              "name": "given name",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-property-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "firstName",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "given_name",
                "jsonType.label": "String"
              }
            },
            {
              "name": "family name",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-property-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "lastName",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "family_name",
                "jsonType.label": "String"
              }
            }
          ]
        }
      ]
    }
